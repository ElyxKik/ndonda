=== GUIDE DE TEST DU SYST√àME D'HISTORIQUE IA ===

## ‚úÖ D√©ploiement Compl√©t√©

### 1. R√®gles Firestore
‚úÖ D√©ploy√©es avec succ√®s
- Collection `ai_conversations` avec permissions par utilisateur
- Chaque utilisateur ne voit que ses propres conversations

### 2. Indexes Firestore
‚úÖ D√©ploy√©s avec succ√®s
- Index composite pour userId + type + updatedAt
- Index composite pour userId + updatedAt
- Les indexes peuvent prendre 5-10 minutes √† √™tre construits

### 3. Optimisation de Requ√™te
‚úÖ Impl√©ment√©e
- Requ√™te de base: userId + tri par updatedAt (pas d'index composite requis)
- Filtrage par type en m√©moire (√©vite le besoin d'index composite imm√©diatement)

## üß™ Proc√©dure de Test

### √âtape 1: Lancer l'application
```bash
flutter run
```

### √âtape 2: Se connecter
- Utiliser un compte Firebase existant
- V√©rifier que l'utilisateur est authentifi√©

### √âtape 3: Tester le Chat Simple (IA - Chat Simple)
1. Acc√©der √†: Menu ‚Üí IA - Chat Simple
2. Envoyer un message (ex: "Bonjour")
3. Attendre la r√©ponse de l'IA
4. Envoyer un deuxi√®me message
5. Cliquer sur le bouton historique (ic√¥ne üïê)
6. V√©rifier que la conversation appara√Æt dans la liste
7. Cliquer sur la conversation pour voir les d√©tails
8. V√©rifier que tous les messages sont affich√©s

### √âtape 4: Tester le Chat Firebase (IA - Donn√©es Firebase)
1. Acc√©der √†: Menu ‚Üí IA - Donn√©es Firebase
2. Envoyer un message (ex: "Quels sont les projets?")
3. Attendre la r√©ponse de l'IA
4. Envoyer un deuxi√®me message
5. Cliquer sur le bouton historique (ic√¥ne üïê)
6. V√©rifier que la conversation appara√Æt dans la liste
7. Cliquer sur la conversation pour voir les d√©tails
8. V√©rifier que tous les messages sont affich√©s

### √âtape 5: Tester la Suppression
1. Dans le modal historique, cliquer sur le menu (‚ãÆ) d'une conversation
2. S√©lectionner "Supprimer"
3. Confirmer la suppression
4. V√©rifier que la conversation dispara√Æt de la liste

### √âtape 6: V√©rifier Firestore
1. Aller sur: https://console.firebase.google.com
2. S√©lectionner le projet: ndonda-verte-62700
3. Aller √†: Firestore Database ‚Üí Collections
4. V√©rifier la collection `ai_conversations`
5. V√©rifier que les documents contiennent:
   - id (UUID)
   - userId (UID de l'utilisateur)
   - type ('simple' ou 'firebase')
   - title (titre g√©n√©r√© du premier message)
   - messages (array avec tous les messages)
   - createdAt (timestamp)
   - updatedAt (timestamp)
   - messageCount (nombre de messages)

## üìä Logs Attendus

### Lors de l'envoi du premier message:
```
‚úÖ Conversation cr√©√©e: [UUID]
‚úÖ Message ajout√© √† la conversation
```

### Lors de l'ouverture du modal historique:
```
‚úÖ Historique charg√©: [nombre] messages
```

### Lors de la suppression:
```
‚úÖ Conversation supprim√©e
```

## ‚ö†Ô∏è Probl√®mes Possibles et Solutions

### Probl√®me 1: "Erreur r√©cup√©ration conversations"
**Cause**: Index Firestore pas encore construit
**Solution**: Attendre 5-10 minutes que l'index se construise
**V√©rification**: Aller sur Firebase Console ‚Üí Firestore ‚Üí Indexes

### Probl√®me 2: "Utilisateur non authentifi√©"
**Cause**: L'utilisateur n'est pas connect√©
**Solution**: Se connecter d'abord avant d'acc√©der aux pages IA

### Probl√®me 3: Les messages ne s'affichent pas dans l'historique
**Cause**: Les messages ne sont pas sauvegard√©s
**V√©rification**: 
- V√©rifier les logs pour les messages d'erreur
- V√©rifier que Firestore est accessible
- V√©rifier les permissions Firestore

### Probl√®me 4: Modal historique vide
**Cause**: Pas de conversations cr√©√©es encore
**Solution**: Envoyer des messages dans le chat d'abord

## üîç V√©rification des Donn√©es

### Dans Firestore Console:
1. Aller √†: Firestore Database ‚Üí Collections
2. S√©lectionner: ai_conversations
3. V√©rifier chaque document:
   - Doit avoir userId = UID de l'utilisateur connect√©
   - Doit avoir type = 'simple' ou 'firebase'
   - Doit avoir messages array avec au moins 2 √©l√©ments
   - Doit avoir messageCount = nombre de messages

### Exemple de document:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "abc123def456",
  "type": "simple",
  "title": "Bonjour",
  "messages": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "role": "user",
      "content": "Bonjour",
      "timestamp": "2025-11-12T13:30:00.000Z"
    },
    {
      "id": "550e8400-e29b-41d4-a716-446655440002",
      "role": "assistant",
      "content": "Bonjour! Comment puis-je vous aider?",
      "timestamp": "2025-11-12T13:30:05.000Z"
    }
  ],
  "createdAt": "2025-11-12T13:30:00.000Z",
  "updatedAt": "2025-11-12T13:30:05.000Z",
  "messageCount": 2
}
```

## ‚úÖ Checklist de Validation

- [ ] R√®gles Firestore d√©ploy√©es
- [ ] Indexes Firestore d√©ploy√©s
- [ ] Application lanc√©e sans erreur
- [ ] Utilisateur connect√©
- [ ] Premier message envoy√© dans Chat Simple
- [ ] Conversation cr√©√©e dans Firestore
- [ ] Bouton historique affiche la conversation
- [ ] Page de d√©tail affiche tous les messages
- [ ] Suppression fonctionne
- [ ] Premier message envoy√© dans Chat Firebase
- [ ] Conversation cr√©√©e dans Firestore
- [ ] Bouton historique affiche la conversation
- [ ] Page de d√©tail affiche tous les messages
- [ ] Filtrage par type fonctionne
- [ ] Permissions Firestore correctes (utilisateur ne voit que ses conversations)

## üìù Notes

- Les indexes peuvent prendre 5-10 minutes √† √™tre construits
- Le filtrage par type se fait en m√©moire pour √©viter les probl√®mes d'index
- Chaque utilisateur ne voit que ses propres conversations
- Les conversations sont tri√©es par date de modification (plus r√©cente en premier)
- Le titre est g√©n√©r√© automatiquement du premier message
